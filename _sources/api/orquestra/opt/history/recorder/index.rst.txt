:py:mod:`orquestra.opt.history.recorder`
========================================

.. py:module:: orquestra.opt.history.recorder

.. autoapi-nested-parse::

   Main implementation of the recorder.



Module Contents
---------------

Classes
~~~~~~~

.. autoapisummary::

   orquestra.opt.history.recorder.ArtifactCollection
   orquestra.opt.history.recorder.HistoryEntry
   orquestra.opt.history.recorder.HistoryEntryWithArtifacts
   orquestra.opt.history.recorder.SimpleRecorder
   orquestra.opt.history.recorder.SimpleRecorderWithGradient
   orquestra.opt.history.recorder.ArtifactRecorder
   orquestra.opt.history.recorder.ArtifactRecorderWithGradient
   orquestra.opt.history.recorder.SimpleRecorderImpl
   orquestra.opt.history.recorder.SimpleRecorderWithGradientImpl
   orquestra.opt.history.recorder.ArtifactRecorderImpl
   orquestra.opt.history.recorder.ArtifactRecorderWithGradientImpl



Functions
~~~~~~~~~

.. autoapisummary::

   orquestra.opt.history.recorder.copy_recorder
   orquestra.opt.history.recorder.deepcopy_recorder
   orquestra.opt.history.recorder.store_artifact
   orquestra.opt.history.recorder.recorder



Attributes
~~~~~~~~~~

.. autoapisummary::

   orquestra.opt.history.recorder.T
   orquestra.opt.history.recorder.S
   orquestra.opt.history.recorder.NATIVE_RECORDER_ATTRIBUTES
   orquestra.opt.history.recorder.AnyRecorder
   orquestra.opt.history.recorder.RecorderFactory
   orquestra.opt.history.recorder.AnyHistory


.. py:data:: T
   

   

.. py:data:: S
   

   

.. py:data:: NATIVE_RECORDER_ATTRIBUTES
   :annotation: = ['predicate', 'history', 'target', 'call_number', 'gradient']

   

.. py:class:: ArtifactCollection

   Bases: :py:obj:`dict`

   A dict with additional `forced` attribute.

   The `forced` flag is set whenever an artifact is forced into the dictionary
   despite current save_condition being false.

   .. py:attribute:: forced
      :annotation: :bool = False

      


.. py:class:: HistoryEntry

   A history entry storing call number, parameters and target function value.

   .. py:attribute:: call_number
      :annotation: :int

      

   .. py:attribute:: params
      :annotation: :Any

      

   .. py:attribute:: value
      :annotation: :Any

      


.. py:class:: HistoryEntryWithArtifacts

   Bases: :py:obj:`HistoryEntry`

   A history entry enhanced with artifacts.

   .. py:attribute:: artifacts
      :annotation: :Dict[str, Any]

      


.. py:function:: copy_recorder(recorder_to_copy)


.. py:function:: deepcopy_recorder(recorder_to_copy, memo)


.. py:class:: SimpleRecorder

   Bases: :py:obj:`Protocol`\ [\ :py:obj:`S`\ , :py:obj:`T`\ ]

   Protocol representing recorder with basic functionalities.

   Simple recorders have target and history attributes. They forward calls made
   to them to the target.

   The target property is exposed so that clients have access to an unwrapped
   callable in case they need to make a call that is not recorder.

   Note that this recorder is structurally a base protocol for any other
   types of recorders. In other words  every recorder is at least a SimpleRecorder.

   .. py:method:: target() -> Callable[[S], T]
      :property:


   .. py:method:: history() -> Sequence[HistoryEntry]
      :property:



.. py:class:: SimpleRecorderWithGradient

   Bases: :py:obj:`Protocol`

   A protocol representing recorders wrapping functions with gradients.

   Aside the attributes of SimpleRecorder, this recorder also has a gradient
   attribute which itself is a recorder (and hence, has its own `history`
   attribute.

   Note that this protocol is not generic, because we only define gradients
   for functions from R^N to R (which translates to Callable[[ndarray], float]).

   .. py:method:: target() -> Callable[[numpy.ndarray], float]
      :property:


   .. py:method:: gradient() -> SimpleRecorder[numpy.ndarray, numpy.ndarray]
      :property:


   .. py:method:: history() -> Sequence[HistoryEntry]
      :property:



.. py:class:: ArtifactRecorder

   Bases: :py:obj:`Protocol`\ [\ :py:obj:`S`\ , :py:obj:`T`\ ]

   A protocol representing recorders that can store artifacts.

   It is like simple recorder, but its target has to be a CallableStoringArtifacts.
   It also stores a list of HistoryEntryWithArtifact objects instead of usual
   HistoryEntry ones.

   .. py:method:: target() -> orquestra.opt.api.functions.CallableStoringArtifacts[S, T]
      :property:


   .. py:method:: history() -> Sequence[HistoryEntryWithArtifacts]
      :property:



.. py:class:: ArtifactRecorderWithGradient

   Bases: :py:obj:`Protocol`

   Protocol for recorders wrapping functions having gradient and storing artifacts.

   It is the most narrow type of recorder, combining both the
   SimpleReorderWithGradient and Artifact recorder. Hence, this recorder is
   non-generic and stores history entries with artifacts.

   .. py:method:: target() -> orquestra.opt.api.functions.CallableWithGradientStoringArtifacts
      :property:


   .. py:method:: gradient() -> SimpleRecorder[numpy.ndarray, numpy.ndarray]
      :property:


   .. py:method:: history() -> Sequence[HistoryEntryWithArtifacts]
      :property:



.. py:class:: SimpleRecorderImpl(target: Callable[[S], T], save_condition: orquestra.opt.api.save_conditions.SaveCondition)

   Bases: :py:obj:`Generic`\ [\ :py:obj:`S`\ , :py:obj:`T`\ ]

   A basic recorder that stores history entries.

   :param target: a target function. Calls to the recorder will be propagated to this
                  function.
   :param save_condition: a function determining whether given call should be saved
                          to the history. See respective protocol for explanation of this parameter.


.. py:class:: SimpleRecorderWithGradientImpl(target: orquestra.opt.api.functions.CallableWithGradient, save_condition: orquestra.opt.api.save_conditions.SaveCondition)

   Bases: :py:obj:`SimpleRecorderImpl`

   A recorder saving history entries that works with callables with gradient.

   Except having `gradient` attribute, this recorder is the same as `SimpleRecorder`.


.. py:class:: ArtifactRecorderImpl(target: orquestra.opt.api.functions.CallableStoringArtifacts[S, T], save_condition: orquestra.opt.api.save_conditions.SaveCondition)

   Bases: :py:obj:`Generic`\ [\ :py:obj:`S`\ , :py:obj:`T`\ ]

   A recorder saving history entries with artifacts.

   Parameters to initializer are the same as for `SimpleRecorder`,
   except the target function should now be capable of storing artifacts.


.. py:class:: ArtifactRecorderWithGradientImpl(target: orquestra.opt.api.functions.CallableWithGradientStoringArtifacts, save_condition: orquestra.opt.api.save_conditions.SaveCondition)

   Bases: :py:obj:`ArtifactRecorderImpl`

   A recorder storing history entries with artifacts supporting callables with
   gradient.


.. py:function:: store_artifact(artifacts) -> orquestra.opt.api.functions.StoreArtifact

   Create a function storing artifacts in given artifacts collection.

   :param artifacts: artifact collection.

   :returns: _store(artifact_name: str, artifact: Any, force: bool = False) -> None:
             This function is intended to be passed to functions that are capable of
             storing artifacts.
   :rtype: A function with signature


.. py:data:: AnyRecorder
   

   

.. py:data:: RecorderFactory
   

   

.. py:data:: AnyHistory
   

   

.. py:function:: recorder(function: orquestra.opt.api.functions.CallableWithGradientStoringArtifacts, save_condition: orquestra.opt.api.save_conditions.SaveCondition = always) -> ArtifactRecorderWithGradient
              recorder(function: orquestra.opt.api.functions.CallableStoringArtifacts[S, T], save_condition: orquestra.opt.api.save_conditions.SaveCondition = always) -> ArtifactRecorder[S, T]
              recorder(function: orquestra.opt.api.functions.CallableWithGradient, save_condition: orquestra.opt.api.save_conditions.SaveCondition = always) -> SimpleRecorderWithGradient
              recorder(function: Callable[[S], T], save_condition: orquestra.opt.api.save_conditions.SaveCondition = always) -> SimpleRecorder[S, T]

   Create a recorder that is suitable for recording calls to given callable.

   :param function: a callable to be recorded.
   :param save_condition: a condition on which the calls will be saved. See
                          `SaveCondition` protocol for explanation of this parameter. By default
                          all calls are saved.

   :returns: A callable object (the recorder) wrapping the `function`.
             The return type depends on the passed callable. See overloads defined
             above to check for available variants. Here is a summary:
             - recorder is always callable

             - if `function` has gradient, so does the recorder. Calls to gradient
               and calls made by gradient are NOT recorded.

             - if `function` has possibility to store artifacts (i.e. accepts
               `store_artifact` argument, then so does the recorder.


